<html>
    <head>
        <title>Sorting algorithms</title>
        <style>
            #bars {
                text-align: center;
                padding: 0;
                height: 100px;
            }
            
            #bars div {
                width: 2em;
                margin: 1px;
                border: SOLID 1px #343026;
                background-color: #ABCDEF;
                position: relative;
                float: left;
            }
            
            #bars .bar-selected {
                background-color: YELLOW;
            }
            
            .bar-mover {
                position: absolute;
                width: 2em;
                height: 0px;
                background-color: BLUE;
                border: DASHED 2px BLACK;
                display: none;
            }
        </style>
        <script type = "text/javascript" src = "http://localhost:8080/ttd/trialtool/lib/jquery/jquery-1.4.2.min.js">
        </script>
        <script>
            var steps = [];
            var isRunning = 0;
            
            function runSteps(){
                var operation = steps[0];
                if (isRunning || !operation) 
                    return;
                operation.op.apply(visualization, operation.args);
                var timerHandler = window.setInterval(function(){
                    if (!isRunning) {
                        window.clearInterval(timerHandler);
                        steps.shift();
                        runSteps();
                    }
                }, 10);
            };
            
            function addStep(op, args){
                steps.push({
                    "op": op,
                    "args": args
                });
                runSteps();
            };
            
            var visualization = (function(){
                var visualSet = [];
                var lastAdded = null;
                return {
                    "swap": function(key1, val1, key2, val2){
                        for (var i = 0; i < visualSet.length; i++) {
                            isRunning++;
                            visualSet[i].swap.apply(visualSet[i], [key1, val1, key2, val2]);
                        }
                    },
                    "select": function(list){
                        for (var i = 0; i < visualSet.length; i++) {
                            isRunning++;
                            visualSet[i].select.call(visualSet[i], list);
                        }
                    },
                    "add": function(visual){
                        visualSet.push(visual);
                        document.write("Added", visual, "to ", visualSet)
                        lastAdded = visual;
                    },
                    "init": function(){
                        if (lastAdded && typeof lastAdded.init === "function") {
                            isRunning++;
                            lastAdded.init();
                        }
                    },
                    "visualSet": visualSet
                }
            })();
        </script>
        <script type="text/javascript">
            var sample = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12];
            var maxX = sample[0];
            for (var i = 0; i < sample.length; i++) {
                (maxX < sample[i]) && (maxX = sample[i]);
            }
            
            function swap(a, b){
                var tmp = sample[b];
                sample[b] = sample[a];
                sample[a] = tmp;
                addStep(visualization.swap, [a, sample[a], b, sample[b]]);
            }
            
            function greater(a, b){
                addStep(visualization.select, [[a, b]]);
                return sample[a] > sample[b] ? sample[a] : sample[b];
            }
        </script>
    </head>
    <body>
        <div id = "console">
        </div>
        <ul>
            <li class = "example-set" id = "prereq">
                <a class = "example-set-name">Activate Visualization</a>
                <ul>
                    <li class = "example">
                        <a class = "example-name">Bars</a>
                        <script type = "text/javascript">
                            var animationDuration = 200;
                            var BarVisualization = {
                                init: function(){
                                    var bars = $("#bars");
                                    if (!bars.length) {
                                        bars = $("<div>", {
                                            "id": "bars"
                                        }).appendTo("#console");
                                    }
                                    bars.empty();
                                    for (var i = 0; i < sample.length; i++) {
                                        var bar = bars.children("#bar_" + i);
                                        if (!bar.length) {
                                            bar = $("<div>", {
                                                "id": "bar_" + i
                                            }).css("top", "50%").appendTo(bars);
                                        }
                                        bar.css({
                                            "height": (sample[i] * 100 / maxX) + "%",
                                            "top": ((maxX - sample[i]) * 50 / maxX) + "%"
                                        });
                                    }
                                    isRunning--;
                                    $("<div>", {
                                        "id": "barA"
                                    }).appendTo("#console").addClass("bar-mover");
                                    $("<div>", {
                                        "id": "barB"
                                    }).appendTo("#console").addClass("bar-mover");
                                },
                                
                                select: function(list){
                                    $("#bars").children("div").removeClass("bar-selected");
                                    for (var i = 0; i < list.length; i++) {
                                        $("#bar_" + list[i]).addClass("bar-selected");
                                    }
                                    window.setTimeout(function(){
                                        isRunning--;
                                    }, animationDuration);
                                },
                                
                                swap: function(key1, val1, key2, val2){
                                    var barA = $("#bar_" + key1);
                                    var barB = $("#bar_" + key2);
                                    
                                    var posA = barA.offset();
                                    var posB = barB.offset();
                                    
                                    $("#barA").css({
                                        "height": barA.height(),
                                        "top": posA.top,
                                        "left": posA.left
                                    }).show();
                                    $("#barB").css({
                                        "height": barB.height(),
                                        "top": posB.top,
                                        "left": posB.left
                                    }).show();
                                    
                                    $("#barB").animate({
                                        "left": posA.left
                                    }, animationDuration);
                                    $("#barA").animate({
                                        "left": posB.left
                                    }, animationDuration);
                                    $("#bar_" + key1 + ",#bar_" + key2).css("opacity", 0.2);
                                    window.setTimeout(function(){
                                        $("#bar_" + key1).css({
                                            "height": (val1 * 100 / maxX) + "%",
                                            "top": ((maxX - val1) * 50 / maxX) + "%"
                                        });
                                        $("#bar_" + key2).css({
                                            "height": (val2 * 100 / maxX) + "%",
                                            "top": ((maxX - val2) * 50 / maxX) + "%"
                                        });
                                        
                                        $("#bar_" + key1 + ",#bar_" + key2).css({
                                            "opacity": 1
                                        });
                                        $("#barA, #barB").hide();
                                        isRunning--;
                                    }, animationDuration);
                                }
                            }
                            visualization.add(BarVisualization);
                            addStep(visualization.init);
                        </script>
                    </li>
                    <li class = "example" id = "drumBeats">
                        <a class ="example-name">Drum Beats</a>
                        <script type="text/javascript">
                            var animationDuration = 10;
                            var base = "http://www.randomthink.net/labs/html5drums/drumkit/";
                            var soundFiles = ["Bass%20Hit", "Clap", "Cow%20Bell", "Hi%20Hat%20Closed", "Hi%20Hat%20Long", "Hi%20Hat%20Short", "Rimshot", "Snare%wav", "Tambourine", "Tom%20Hi", "Tom%20Low", "Tom%20Mid"];
                            
                            var Sounds = (function(){
                                var audio = new Audio("");
                                var ext = "";
                                if (audio.play) {
                                    mime = audio.canPlayType("audio/mpeg");
                                    if (mime.length > 0 && mime != "no") {
                                        ext = ".mp3";
                                    }
                                    mime = audio.canPlayType("audio/x-wav");
                                    if (mime.length > 0 && mime != "no") {
                                        ext = ".wav";
                                    }
                                    mime = audio.canPlayType("audio/wav");
                                    if (mime.length > 0 && mime != "no") {
                                        ext = ".wav";
                                    }
                                }
                                var audio = [];
                                var init = function(){
                                    var onCanplaythrough = function(){
                                        stillToLoad--;
                                        if (!stillToLoad) {
                                            document.write("Initialized Grand Piano Sounds. You should have heard a sound.");
                                            audio[0].play();
                                            isRunning--;
                                        }
                                    };
                                    var stillToLoad = 0;
                                    for (var i = 0; i < soundFiles.length; i++) {
                                        audio[i] = new Audio("");
                                        audio[i].src = base + soundFiles[i] + ext;
                                        audio[i].load();
                                        stillToLoad++;
                                        audio[i].addEventListener("canplaythrough", onCanplaythrough, false);
                                        audio[i].addEventListener("error", onCanplaythrough, false);
                                    }
                                };
                                
                                return {
                                    init: init,
                                    select: function(list){
                                        for (var i = 0; i < list; i++) {
                                            audio[list[i]].play();
                                        }
                                        window.setTimeout(function(){
                                            isRunning--;
                                        }, animationDuration);
                                        
                                    },
                                    swap: function(key1, val1, key2, val2){
                                        audio[val1 - 1].play();
                                        audio[val2 - 1].play();
                                        window.setTimeout(function(){
                                            isRunning--;
                                        }, animationDuration);
                                    },
                                    "audio": audio
                                };
                            })();
                            
                            visualization.add(Sounds);
                            addStep(visualization.init);
                        </script>
                    </li>
                    <li class = "example" depends = "drumBeats">
                        <a class = "">Grand Piano</a>
                        <script type = "text/javascript">
                            var animationDuration = 100;
                            var base = "http://github.com/azoff/HTML5piano/raw/master/instruments/grandPiano/";
                            var soundFiles = ["a", "b", "bb", "c", "cs", "d", "e", "eb", "f", "fs", "g", "gs"];
                        </script>
                    </li>
                    <li class = "example">
                        <a class = "example-name">None</a>
                        <script type = "text/javascript">
                            document.write(visualization.visualSet);
                            visualization.visualSet = [];
                        </script>
                    </li>
                </ul>
            </li>
            <li class = "example-set" id = "input">
                <a class = "example-set-name">Change Input</a>
                <ul>
                    <li class = "example">
                        <a class = "example-name">Randomize Input</a>
                        <script type = "text/javascript">
                            addStep(visualization.init);
                            for (var i = 0; i < sample.length - 1; i++) {
                                var b = i + 1 + parseInt(Math.random() * 100) % (sample.length - i - 1);
                                swap(i, b);
                            }
                        </script>
                    </li>
                    <li class = "example">
                        <a class ="example-name">Sorted Input</a>
                        <script type = "text/javascript">
                            for (var i = 0; i < maxX; i++) {
                                sample[i] = i + 1;
                            }
                            visualization.init();
                        </script>
                    </li>
                    <li class = "example">
                        <a class ="example-name">Reverse Sorted Input</a>
                        <script type = "text/javascript">
                            for (var i = 0; i < maxX; i++) {
                                sample[i] = maxX - i;
                            }
                            visualization.init();
                        </script>
                    </li>
                </ul>
            </li>
            <li class="example-set" id = "sorting">
                <a class = "example-set-name" href = "#">Sorting Algorithms</a>
                <ul>
                    <li class = "example" id = "insertion-sort">
                        <a class = "example-name" href = "#">Insertion Sort</a>
                        <script type="text/javascript">
                            for (var i = 0; i < sample.length; i++) {
                                for (var j = i + 1; j < sample.length; j++) {
                                    if (greater(i, j) === sample[i]) {
                                        swap(i, j);
                                    }
                                }
                            }
                        </script>
                    </li>
                </ul>
            </li>
        </ul>
    </body>
</html>
